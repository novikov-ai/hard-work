# Страшное слово в ваших спецификациях

## Пример 1 - Копирование конфигураций микросервисов  

**Контекст**  
При автоматизации развертывания микросервисов требовалось клонировать конфигурации окружений (dev, staging, prod). Первоначальная спецификация гласила: «Копировать все параметры конфигурации».  

**Ограничение от «всего»**  
Системные параметры (например, секреты, уникальные идентификаторы сервисов) нельзя дублировать между окружениями.  

**Как ограничивали**  
- Ввели шаблоны конфигураций с переменными, заменяемыми в зависимости от окружения.  
- Добавили метки `environment_specific` для параметров, которые не копируются автоматически (например, API-ключи, URLs баз данных).  


## Пример 2 - Логирование межсервисных запросов  

**Контекст**  
В распределенной системе требовалось «логировать все HTTP-запросы между микросервисами для аудита».  

**Ограничение от «всего»**  
Логирование каждого запроса (включая body с персональными данными) нарушало GDPR и увеличивало нагрузку на хранилище.  

**Как ограничивали**  
- Реализовали фильтрацию через API-шлюз:  
  - Маскировали sensitive-поля (например, `email`, `credit_card`) в body.  
  - Логировали только метаданные (HTTP-метод, статус, путь) для не-critical операций.  

## Пример 3 - Интеграция с платежным провайдером  

**Контекст**  
Микросервис оплаты должен был передавать «все данные транзакции» внешнему провайдеру для обработки.  

**Отказ от «всего»**  
Передача внутренних идентификаторов заказов и пользовательских сессий создавала риски утечки бизнес-логики.  

**Как перепроектировали**  
- Ввели промежуточный слой (фасад):  
  - Генерировали уникальные внешние ID для транзакций, не связанные с внутренней системой.  
  - Ограничили передаваемые данные до минимального набора (сумма, валюта, токен карты).  


## Пример 4 - Управление правами доступа к API  

**Контекст**  
Администраторы имели право «управлять всеми методами API через сервис-меш».  

**Ограничение от «всего»**  
Риск случайного отключения критических endpoints (например, аутентификации или биллинга).  

**Как ограничивали**  
- Реализовали RBAC (Role-Based Access Control) с зонированием прав:  
  - Разделили API на группы (например, `auth`, `billing`, `analytics`).  
  - Назначили роли с доступом только к определенным группам (например, `billing_admin` не может изменять `auth`-endpoints).  

## Пример 5 - Транзакции в распределенной системе  

**Контекст**  
Требовалось «откатывать все изменения при ошибке в цепочке микросервисов».  

**Отказ от «всего»**  
Полный откат (Saga rollback) для всех сервисов был невозможен из-за неидемпотентных операций (например, отправка email).  

**Как перепроектировали**  
- Внедрили компенсирующие транзакции вместо глобального отката:  
  - Для каждого шага цепочки определили обратную операцию (например, отмена резерва товара, но не отзыв отправленного email).  
  - Использовали паттерн Circuit Breaker для изоляции сбоев и ручного восстановления.  

Во всех случаях ключевым было **уйти от неявной полноты** («все параметры», «все запросы») к явному контролю над данными и операциями.