# Об опасности стандартных подходов

## Важные структуры данных непосредственно присутствуют в коде

Все важные структуры данных непосредственно существует в проекте на уровне кода. При этом используются разные DTO (data transfer object): одни для транспорта, другие для уровния приложеничя, третьи для базы данных.

## Как можно строить REST API, не используя id-шки в качестве идентификаторов в глобальном хранилище данных (и отказавшись от ORM).

### Гипермедийный подход (HATEOAS)

Клиент взаимодействует с API через ссылки, встроенные в ответы сервера, вместо жесткого знания URL или ID ресурсов.  

- При создании ресурса (например, пользователя) сервер возвращает ответ с гиперссылками на связанные действия (например, `self`, `update`, `delete`).  
- Клиент не хранит ID, а следует предоставленным ссылкам. Например:  
  ```json
  {
    "user": {
      "name": "Alice",
      "_links": {
        "self": "/users/alice@example.com",
        "orders": "/users/alice@example.com/orders"
      }
    }
  }
  ```  

**Преимущества**:  
- Устраняет зависимость от глобальных ID — клиент опирается на относительные пути и контекстные ссылки.  
- Повышает гибкость: изменения структуры API не ломают клиент, если ссылки генерируются динамически.  
- Минимизирует использование ORM, так как модель данных строится вокруг ресурсов, а не таблиц БД.

### Составные ключи на основе атрибутов ресурса

Использование уникальных комбинаций атрибутов ресурса вместо глобальных ID.  

- Для пользователя: `email` (при условии гарантированной уникальности).  
- Для заказа: `/users/{email}/orders/{order_date}_{hash}`, где `hash` генерируется на основе времени и данных заказа.  
- Сервер валидирует уникальность составного ключа (например, `email + timestamp`).  
- Клиент передает ключи в запросах, но они не требуют глобального хранилища — уникальность обеспечивается контекстом.  

**Преимущества**:  
- Нет глобальных ID — идентификация локализована в рамках домена (например, заказы принадлежат пользователю).  
- Упрощает отказ от ORM, так как модель данных описывается через бизнес-атрибуты, а не через связи БД.  


### Временные токены с контекстной областью видимости

Генерация уникальных токенов, действительных только в рамках конкретной операции или сессии.  

- При создании ресурса (например, платежа) сервер возвращает токен вида `pay_123abc`, который привязан к текущему контексту (например, сессии пользователя).  
- Токен используется для последующих запросов (например, отмена платежа через `DELETE /payments/pay_123abc`).  
- Токен не хранится в глобальном хранилище — его валидность проверяется через криптографическую подпись или временное хранение в памяти.  

**Преимущества**:  
- Нет глобальных ID — токены имеют ограниченный срок жизни и область действия.  
- Снижает риски утечек: даже при компрометации токена злоумышленник не сможет получить доступ к другим ресурсам.  
- ORM не требуется, так как данные управляются через сервисный слой, работающий с токенами и контекстами.